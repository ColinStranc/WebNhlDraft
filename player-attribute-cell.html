<link rel="import" href="../polymer/polymer.html">

<dom-module id="player-attribute-cell">
    <template>
        <style>
            .attribute-rankings {
                display: inline-flex;
                color: #234A3D;
            }

            .attribute-name {
                color: #6BE3B9;
                font-size: 12px;
                text-align: center;
                line-height: 0.8;
            }

            .container {
                display: flex;
                flex-direction: column;
                align-items: center;

                width: 50px;
                padding: 3px 5px;
            }

            .league-percentile {
                color: blue;
            }

            .position-percentile {
                color: orangered;
            }

            .available-percentile {
                color: grey;
            }
        </style>

        <div class="container">
            <div class="attribute-name">[[attributeName.shortName]]</div>
            <div class="attribute-rankings">
                <div class="attribute-value">[[attributeValue]]</div>
                <div class="attribute-percentile">
                    <template is="dom-if" if="{{compareWithLeague}}">
                        <div class="league-percentile">([[_calculateLeaguePercentile(attributeId, attributeValue)]])</div>
                    </template>
                    <template is="dom-if" if="{{compareWithPosition}}">
                        <div class="position-percentile">([[_calculatePositionPercentile(attributeId, attributeValue, playerPosition)]])</div>
                    </template>
                    <template is="dom-if" if="{{compareWithAvailable}}">
                        <div class="available-percentile">([[_calculateAvailablePercentile(attributeId, attributeValue)]])</div>
                    </template>
                </div>
            </div>
        </div>
    </template>

    <script>
    Polymer({
        is: 'player-attribute-cell',
        properties: {
            attributeId: Number,
            attributeName: {
                type: String,
                computed: '_getAttributeName(attributeId)'
            },
            attributeValue: {
                type: String,
                value: '-'
            },
            compareWithLeague: {
                type: Boolean,
                value: false
            },
            compareWithPosition: {
                type: Boolean,
                value: false
            },
            compareWithAvailable: {
                type: Boolean,
                value: false
            },
            displayedPercentile: {
                type: String,
                value: 'league',
                observer: 'setDisplayedPercentile'
            },
            playerPosition: {
                type: String,
                value: 'Unset'
            }
        },
        _getAttributeName: function(id) {
            // this knowledge obviously shouldn't be here.
            var attributes = [{shortName: 'OVR', longName: 'Overall'}, {shortName: 'SAL', longName: 'Salary'}, 
                                {shortName: 'SPD', longName: 'Speed'}, {shortName: 'SSA', longName: 'Slap Shot Accuracy'},
                                {shortName: 'OFA', longName: 'Offensive Awareness'}, {shortName: 'DFA', longName: 'Defensive Awareness'}];
            if (id <= attributes.length) {
                return attributes[id-1];
            }
            return '-';
        },
        _calculateLeaguePercentile: function(id, value) {
            return this._calculatePercentile(id, value, 'league');
        },
        _calculatePositionPercentile: function(id, value, position) {
            if (position === 'Unset') {
                console.log('cannot find positional percentile for "' + this.attributeName + '", not given player-position.');
                return '-';
            }
            return this._calculatePercentile(id, value, 'position', position);
        },
        _calculateAvailablePercentile: function(id, value) {
            return this._calculatePercentile(id, value, 'available');
        },
        _calculatePercentile: function(id, value, type, position = null) {
            return window.webNhlDraft.percentileFunctionality.calculatePercentile(id, value, type, position);
        },
        setDisplayedPercentile: function(name) {
            if (name === 'league') {
                this.compareWithPosition = false;
                this.compareWithAvailable = false;
                this.compareWithLeague = true;
            }
            if (name === 'position') {
                this.compareWithLeague = false;
                this.compareWithAvailable = false;
                this.compareWithPosition = true;
            }
            if (name === 'available') {
                this.compareWithLeague = false;
                this.compareWithPosition = false;
                this.compareWithAvailable = true;
            }
        }
    });
    </script>
</dom-module>